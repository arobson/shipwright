#!/usr/bin/env node
var format = require( "util" ).format;
var path = require( "path" );
var goggles = require( "buildgoggles" );
var githubChangeRemoteFile = require( "github-change-remote-file" );
var pequod = require( "pequod" );
var docker = function( sudo ) {
  return pequod( sudo, log );
}
var settings = require( "../src/settings" )( goggles );
var dockyard = require( "../src/index" )( log, goggles, docker, settings );
var github = require( "../src/github" )( log, githubChangeRemoteFile );
var when = require( "when" );

settings
  .getDefaultInfo()
  .then( function( info ) {
    require( "yargs" )
      .usage( "$0 <command> <target> [options]" )
      .command( require( "../src/commands/build" )( dockyard, github, settings, info ) )
      .strict()
      .demandCommand()
      .help()
      .version()
      .argv;
} );

function dockerLog( lines ) {
  lines.split( "\n" )
    .forEach( function( line ) {
      if( line ) {
        console.log( "\u1F433  " + line );
      }
    } );
}

function log() {
  var args = Array.prototype.slice.call( arguments );
  console.log( "\u2693  " + format.apply( null, args ) );
}
